<style>
    /* ----------------------- */
    /* SIDEBAR STYLES */
    /* ----------------------- */
    .sidebar {
        width: 250px;
        height: calc(100vh - 60px); /* Fill viewport height minus top navbar */
        position: fixed;
        left: 0;
        top: 60px;
        background: #2c3e50;
        color: white;
        transition: all 0.3s;
        z-index: 1000;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        padding-top: 50px; /* Space for the fixed sidebar header */
    }
    .sidebar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        position: fixed;
        width: 250px;
        top: 60px;
        z-index: 1001;
        background: #2c3e50;
    }
    .toggle-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
    }
    .nav {
        padding: 20px 0;
    }
    .nav-link {
        color: #ecf0f1;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        transition: all 0.3s;
        text-decoration: none;
    }
    .nav-link i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
    }
    .nav-link:hover,
    .nav-link.active {
        background: #3498db;
        color: white;
    }
    /* collapsed sidebar */
    .sidebar.collapsed {
        width: 70px;
    }
    .sidebar.collapsed .nav-link span,
    .sidebar.collapsed .sidebar-header h3 {
        display: none;
    }
    .sidebar.collapsed .nav-link {
        justify-content: center;
        padding: 12px 0;
    }
    .sidebar.collapsed .nav-link i {
        margin-right: 0;
        font-size: 1.2rem;
    }
    /* collapsed header */
    .sidebar.collapsed .sidebar-header {
        width: 70px;
        padding: 10px 0;
        text-align: center;
    }
    .sidebar.collapsed .toggle-btn {
        margin: 0 auto;
        display: block;
    }
    .sidebar.collapsed .toggle-btn i::before {
        content: "\f0c9"; /* FontAwesome hamburger icon */
    }
    /* MOBILE */
    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
        }
        .sidebar.show {
            transform: translateX(0);
        }
        .sidebar.collapsed {
            width: 250px;
        }
    }
    /* Content offset for main page */
    .main-content {
        margin-left: 250px; /* Initial space for open sidebar */
        transition: margin-left 0.3s;
    }
    .sidebar.collapsed ~ .main-content {
        margin-left: 70px; /* Space for collapsed sidebar */
    }
    @media (max-width: 768px) {
        .main-content {
            margin-left: 0;
        }
    }
</style>


<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="d-flex justify-content-between align-items-center w-100">
            <h3 class="mb-0">Menu</h3>
            <button class="toggle-btn" id="sidebarToggle" type="button">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <ul class="nav flex-column">
     <li class="nav-item">
        <a href="{% url 'admin_panel:admin_dashboard' %}" class="nav-link {% if page == 'dashboard' %}active{% endif %}" id="nav-dashboard">
            <i class="fas fa-user-shield"></i>
            <span>Admin Dashboard</span>
        </a>
    </li>

        <li class="nav-item">
            <a href="{% url 'admin_panel:admin_policy_management' %}" class="nav-link {% if page == 'policies' %}active{% endif %}" id="nav-policies">
                <i class="fas fa-file-contract"></i>
                <span class="ms-2">Manage Policies</span>
            </a>
        </li>

        <li class="nav-item">
            <a href="{% url 'admin_panel:admin_claims' %}"
               class="nav-link {% if request.resolver_match.url_name == 'admin_claims' %}active{% endif %}"
               id="nav-claims">
                <i class="fas fa-file-medical"></i>
                <span>View Claims</span>
            </a>
        </li>

         <!-- ADDED: Feedback and Support Section -->
        <li class="nav-item">
            <a href="{% url 'admin_panel:feedback_dashboard' %}"
               class="nav-link {% if request.resolver_match.url_name == 'feedback_dashboard' or request.resolver_match.url_name == 'view_ticket' or request.resolver_match.url_name == 'resolve_ticket' or request.resolver_match.url_name == 'add_comment' %}active{% endif %}"
               id="nav-feedback">
                <i class="fas fa-headset"></i>
                <span>Feedback & Support</span>
                {% if feedback_count and feedback_count > 0 %}
                <span class="badge bg-danger rounded-pill ms-auto" id="feedback-badge">{{ feedback_count }}</span>
                {% endif %}
            </a>
        </li>

        <li class="nav-item">
            <a href="{% url 'admin_panel:reports_dashboard' %}" class="nav-link {% if page == 'reports' %}active{% endif %}" id="nav-reports">
                <i class="fas fa-chart-bar"></i>
                <span>Reports & Analytics</span>
            </a>
        </li>
    </ul>
</div>

<script>
    // Note: The main page must also have logic for 'topNavToggle' and the main-content
    // to handle the layout shift and mobile closing functionality.

    // We only define the core toggle logic here.
    document.addEventListener('DOMContentLoaded', function () {
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');

        // This is necessary if the main page doesn't define this logic
        const topNavToggle = document.getElementById('topNavToggle');

        function toggleSidebar() {
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('show');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', function (e) {
                e.stopPropagation();
                toggleSidebar();
            });
        }

        if (topNavToggle) {
            topNavToggle.addEventListener('click', function (e) {
                e.stopPropagation();
                toggleSidebar();
            });
        }

        // Handle mobile closing logic (needs context of the main page)
        document.addEventListener('click', function (event) {
            if (
                window.innerWidth <= 768 &&
                sidebar && sidebar.classList.contains('show') &&
                !sidebar.contains(event.target) &&
                event.target !== topNavToggle
            ) {
                sidebar.classList.remove('show');
            }
        });

        // Handle resize logic
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                if (sidebar.classList.contains('show')) {
                    sidebar.classList.remove('show');
                }
            } else {
                if (sidebar.classList.contains('collapsed')) {
                    sidebar.classList.remove('collapsed');
                }
            }
        });
    });
</script>